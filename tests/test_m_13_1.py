import pytest
from src.module_13 import (
    m_13_1_1,
    m_13_1_2,
    m_13_1_3,
    m_13_1_4,
    m_13_1_5,
    m_13_1_6,
    m_13_1_7,
    m_13_1_8,
)

# для запуска pytest -k "test_13_1_" -q -x --tb=short


# === Тест для задачи 13.1.1 ===


@pytest.mark.parametrize(
    "matrix, expected",
    [
        # matrix1 — базовая 3×3
        (
            [
                [1, 2, 3],
                [4, 5, 6],
                [7, 8, 9],
            ],
            [6, 15, 24],
        ),
        # matrix2 — отрицательные числа
        (
            [
                [-1, -2, -3],
                [-4, -5, -6],
                [-7, -8, -9],
            ],
            [-6, -15, -24],
        ),
        # matrix3 — все нули
        (
            [
                [0, 0, 0],
                [0, 0, 0],
                [0, 0, 0],
            ],
            [0, 0, 0],
        ),
        # matrix4 — одна строка
        (
            [[1, 2, 3]],
            [6],
        ),
        # matrix5 — пустая матрица
        (
            [],
            [],
        ),
        # matrix6 — разная длина строк
        (
            [
                [1, 2],
                [3, 4, 5],
                [6, 7, 8, 9],
            ],
            [3, 12, 30],
        ),
        # matrix7 — большая матрица 1000×1000
        (
            [[1] * 1000 for _ in range(1000)],
            [1000] * 1000,
        ),
    ],
    ids=[
        "basic_3x3",
        "negative_numbers",
        "zeros",
        "single_row",
        "empty_matrix",
        "irregular_rows",
        "large_matrix_1000x1000",
    ],
)
def test_13_1_1(matrix, expected):
    assert m_13_1_1(matrix) == expected


# === Тест для задачи 13.1.2 ===


@pytest.mark.parametrize(
    "matrix, expected",
    [
        # Пример из условия
        (
            [
                ["П", "р", "и"],
                ["в", "е", "т"],
                ["!", "!", "!"],
            ],
            "Пв!ре!ит!",
        ),
        # matrix1 — 3 строки, 4 столбца
        (
            [
                ["А", "б", "в", "г"],
                ["д", "е", "ж", "з"],
                ["и", "й", "к", "л"],
            ],
            "Адибейвжкгзл",
        ),
        # matrix2 — 4 строки, 3 столбца
        (
            [
                ["Х", "е", "л"],
                ["л", "о", " "],
                [" ", " ", "м"],
                ["м", "и", "р"],
            ],
            "Хл мео ил мр",
        ),
        # matrix3 — разные символы, проверяем порядок чтения
        (
            [
                ["Ш", "и", "ф"],
                ["р", "о", "в"],
                ["а", "я", "с"],
                ["!", "!", "!"],
            ],
            "Шра!иоя!фвс!",
        ),
        # Дополнительный тест — одна строка
        (
            [["O", "K", "!"]],
            "OK!",
        ),
        # Дополнительный тест — один столбец
        (
            [["А"], ["Б"], ["В"]],
            "АБВ",
        ),
    ],
    ids=[
        "example_basic",
        "matrix1_3x4",
        "matrix2_4x3",
        "matrix3_symbols",
        "single_row",
        "single_column",
    ],
)
def test_13_1_2(matrix, expected):
    assert m_13_1_2(matrix) == expected


# === Тест для задачи 13.1.3 ===


@pytest.mark.parametrize(
    "a, b, expected",
    [
        # Пример из условия
        (
            [
                [1, 2, 3],
                [4, 5, 6],
            ],
            [
                [7, 8, 9],
                [10, 11, 12],
            ],
            [
                [8, 10, 12],
                [14, 16, 18],
            ],
        ),
        # Разный размер по столбцам
        (
            [
                [1, 2],
                [3, 4],
            ],
            [
                [5, 6, 7],
                [8, 9, 10],
            ],
            "Матрицы разного размера - сложение невозможно.",
        ),
        # Матрицы из нулей
        (
            [
                [1, 1],
                [1, 1],
            ],
            [
                [0, 0],
                [0, 0],
            ],
            [
                [1, 1],
                [1, 1],
            ],
        ),
        # Матрицы с отрицательными числами
        (
            [
                [-1, -2],
                [-3, -4],
            ],
            [
                [5, 6],
                [7, 8],
            ],
            [
                [4, 4],
                [4, 4],
            ],
        ),
        # Большие числа
        (
            [
                [1000, 2000],
                [3000, 4000],
            ],
            [
                [5000, 6000],
                [7000, 8000],
            ],
            [
                [6000, 8000],
                [10000, 12000],
            ],
        ),
        # Разное число строк
        (
            [
                [1, 2],
                [3, 4],
                [5, 6],
            ],
            [
                [7, 8],
                [9, 10],
            ],
            "Матрицы разного размера - сложение невозможно.",
        ),
        # Квадратные одинаковые матрицы 2×2
        (
            [
                [1, 2],
                [3, 4],
            ],
            [
                [5, 6],
                [7, 8],
            ],
            [
                [6, 8],
                [10, 12],
            ],
        ),
    ],
    ids=[
        "example_basic",
        "different_columns",
        "zeros_matrix",
        "negative_numbers",
        "large_numbers",
        "different_rows",
        "square_2x2",
    ],
)
def test_13_1_3(a, b, expected):
    assert m_13_1_3(a, b) == expected


# === Тест для задачи 13.1.4 ===


@pytest.mark.parametrize(
    "matrix, expected",
    [
        # Пример из условия
        (
            [
                [5, 7, 1],
                [2, 0, 9],
            ],
            [
                [5, 2],
                [7, 0],
                [1, 9],
            ],
        ),
        # Прямоугольная матрица 3x2
        (
            [
                [1, 2],
                [3, 4],
                [5, 6],
            ],
            [
                [1, 3, 5],
                [2, 4, 6],
            ],
        ),
        # Прямоугольная матрица 2x3
        (
            [
                [1, 2, 3],
                [4, 5, 6],
            ],
            [
                [1, 4],
                [2, 5],
                [3, 6],
            ],
        ),
        # Матрица 1x1
        ([[7]], [[7]]),
        # Матрица 2x3 с последовательными числами
        (
            [
                [1, 3, 5],
                [2, 4, 6],
            ],
            [
                [1, 2],
                [3, 4],
                [5, 6],
            ],
        ),
        # Квадратная 3x3
        (
            [
                [1, 2, 3],
                [4, 5, 6],
                [7, 8, 9],
            ],
            [
                [1, 4, 7],
                [2, 5, 8],
                [3, 6, 9],
            ],
        ),
        # Проверка на повторение одной из матриц
        (
            [
                [1, 2],
                [3, 4],
                [5, 6],
            ],
            [
                [1, 3, 5],
                [2, 4, 6],
            ],
        ),
    ],
    ids=[
        "example_basic",
        "rectangular_3x2",
        "rectangular_2x3",
        "single_element",
        "two_by_three",
        "square_3x3",
        "repeat_case",
    ],
)
def test_13_1_4(matrix, expected):
    assert m_13_1_4(matrix) == expected


# === Тест для задачи 13.1.5 ===


@pytest.mark.parametrize(
    "matrix, expected",
    [
        # Пример из условия
        (
            [
                [6, 1, 1],
                [4, -2, 5],
                [2, 8, 7],
            ],
            -306,
        ),
        # Различные тестовые матрицы
        (
            [
                [1, 2, 3],
                [0, 1, 4],
                [5, 6, 0],
            ],
            1 * (1 * 0 - 4 * 6) - 2 * (0 * 0 - 4 * 5) + 3 * (0 * 6 - 1 * 5),
        ),
        (
            [
                [4, 6, 8],
                [1, 3, 5],
                [2, 4, 6],
            ],
            0,
        ),
        (
            [
                [3, 5, 7],
                [1, 4, 6],
                [2, 8, 9],
            ],
            3 * (4 * 9 - 6 * 8) - 5 * (1 * 9 - 6 * 2) + 7 * (1 * 8 - 4 * 2),
        ),
        (
            [
                [2, 3, 5],
                [7, 11, 13],
                [17, 19, 23],
            ],
            2 * (11 * 23 - 13 * 19) - 3 * (7 * 23 - 13 * 17) + 5 * (7 * 19 - 11 * 17),
        ),
        (
            [
                [1, 2, 3],
                [4, 5, 6],
                [7, 8, 9],
            ],
            0,
        ),
        (
            [
                [0, 1, 0],
                [0, 0, 1],
                [1, 0, 0],
            ],
            1,
        ),
    ],
    ids=[
        "example_from_task",
        "matrix1",
        "matrix2_zero_det",
        "matrix3_negative",
        "matrix4_primes",
        "matrix5_degenerate",
        "matrix6_permutation",
    ],
)
def test_13_1_5(matrix, expected):
    assert m_13_1_5(matrix) == expected


@pytest.mark.parametrize(
    "invalid_matrix",
    [
        [[1, 2], [3, 4]],  # 2x2
        [[1, 2, 3, 4], [5, 6, 7, 8], [9, 10, 11, 12]],  # 3x4
        [[1, 2, 3]],  # 1x3
        [[1, 2, 3], [4, 5, 6]],  # 2x3
        [],  # пустая
    ],
    ids=[
        "2x2_matrix",
        "3x4_matrix",
        "1x3_matrix",
        "2x3_matrix",
        "empty_matrix",
    ],
)
def test_13_1_5_invalid_shape(invalid_matrix):
    with pytest.raises(ValueError):
        m_13_1_5(invalid_matrix)


# === Тест для задачи 13.1.6 ===


@pytest.mark.parametrize(
    "a, b, expected",
    [
        # === Пример из условия ===
        (
            [
                [1, 2, 3],
                [4, 5, 6],
            ],
            [
                [7, 8],
                [9, 10],
                [11, 12],
            ],
            [
                [58, 64],
                [139, 154],
            ],
        ),
        # === Классический пример 2×2 * 2×2 ===
        (
            [
                [1, 2],
                [3, 4],
            ],
            [
                [5, 6],
                [7, 8],
            ],
            [
                [19, 22],
                [43, 50],
            ],
        ),
        # === Несовместимые матрицы (1×3) * (2×2) ===
        (
            [
                [1, 2, 3],
            ],
            [
                [4, 5],
                [6, 7],
            ],
            "❌ Матрицы несовместимы - нельзя перемножить",
        ),
        # === Единичная матрица (2×2) * (2×2) ===
        (
            [
                [1, 0],
                [0, 1],
            ],
            [
                [5, 6],
                [7, 8],
            ],
            [
                [5, 6],
                [7, 8],
            ],
        ),
        # === Пример 1×3 * 3×1 = 1×1 (скаляр) ===
        (
            [
                [2, 3, 4],
            ],
            [
                [5],
                [6],
                [7],
            ],
            [
                [2 * 5 + 3 * 6 + 4 * 7],
            ],
        ),
        # === Совместимый тест из условия повторно ===
        (
            [
                [1, 2, 3],
                [4, 5, 6],
            ],
            [
                [7, 8],
                [9, 10],
                [11, 12],
            ],
            [
                [58, 64],
                [139, 154],
            ],
        ),
        # === Несовместимые матрицы (1×2) * (1×3) ===
        (
            [
                [1, 2],
            ],
            [
                [3, 4, 5],
            ],
            "❌ Матрицы несовместимы - нельзя перемножить",
        ),
        # === Проверка на 3×3 * 3×3 ===
        (
            [
                [1, 2, 3],
                [0, 1, 4],
                [5, 6, 0],
            ],
            [
                [7, 8, 9],
                [1, 2, 3],
                [0, 1, 2],
            ],
            [
                [9, 15, 21],
                [1, 6, 11],
                [41, 52, 63],
            ],
        ),
    ],
    ids=[
        "example_from_task",
        "square_2x2",
        "incompatible_1x3_2x2",
        "identity_matrix",
        "scalar_result",
        "repeat_example",
        "incompatible_1x2_1x3",
        "square_3x3",
    ],
)
def test_13_1_6(a, b, expected):
    assert m_13_1_6(a, b) == expected


# === Тест для задачи 13.1.7 ===


@pytest.mark.parametrize(
    "matrix, expected",
    [
        # === Пример 1 из задания ===
        (
            [
                [1, 0, 1],
                [0, 1, 0],
                [1, 0, 1],
            ],
            True,
        ),
        # === Пример 2 из задания ===
        (
            [
                [2, 3, 2],
                [4, 2, 5],
                [2, 6, 7],
            ],
            False,
        ),
        # === Пример 3 из задания (неквадратная матрица) ===
        (
            [
                [1, 2, 3],
                [4, 5, 6],
            ],
            "Матрица не квадратная",
        ),
        # === Простая 2×2, диагонали совпадают ===
        (
            [
                [1, 2],
                [2, 1],
            ],
            False,
        ),
        # === Простая 2×2, диагонали не совпадают ===
        (
            [
                [1, 2],
                [3, 4],
            ],
            False,
        ),
        # === Ещё одна 3×3 с одинаковыми диагоналями ===
        (
            [
                [5, 0, 5],
                [0, 5, 0],
                [5, 0, 5],
            ],
            True,
        ),
        # === 3×3, диагонали различаются ===
        (
            [
                [1, 0, 2],
                [0, 1, 0],
                [3, 0, 4],
            ],
            False,
        ),
        # === 3×2 — не квадратная ===
        (
            [
                [1, 2],
                [3, 4],
                [5, 6],
            ],
            "Матрица не квадратная",
        ),
        # === 1×1 — обе диагонали совпадают ===
        (
            [
                [7],
            ],
            True,
        ),
    ],
    ids=[
        "example_true",
        "example_false",
        "not_square_2x3",
        "square_2x2_true",
        "square_2x2_false",
        "square_3x3_true",
        "square_3x3_false",
        "not_square_3x2",
        "single_element_matrix",
    ],
)
def test_13_1_7(matrix, expected):
    assert m_13_1_7(matrix) == expected


# === Тест для задачи 13.1.8 ===


@pytest.mark.parametrize(
    "matrix, expected",
    [
        # 1 — базовый True
        (
            [
                [3, 0, 0, 0, 3],
                [0, 2, 0, 2, 0],
                [0, 0, 1, 0, 0],
                [0, 2, 0, 2, 0],
                [3, 0, 0, 0, 3],
            ],
            True,
        ),
        # 2 — несбалансированные диагонали
        (
            [
                [1, 0, 2],
                [0, 5, 0],
                [2, 0, 1],
            ],
            False,
        ),
        # 3 — чётная матрица
        ([[1, 2], [3, 4]], "Матрица не подходит"),
        # 4 — 5x5 возрастающая
        (
            [
                [1, 2, 3, 4, 5],
                [6, 7, 8, 9, 10],
                [11, 12, 13, 14, 15],
                [16, 17, 18, 19, 20],
                [21, 22, 23, 24, 25],
            ],
            True,
        ),
        # 5 — обычная 3x3
        (
            [
                [1, 2, 3],
                [4, 5, 6],
                [7, 8, 9],
            ],
            True,
        ),
        # 6 — чётная
        (
            [
                [1, 2, 3, 4],
                [5, 6, 7, 8],
                [9, 10, 11, 12],
                [13, 14, 15, 16],
            ],
            "Матрица не подходит",
        ),
        # 7 — перевёрнутая последняя строка
        (
            [
                [1, 2, 3, 4, 5],
                [6, 7, 8, 9, 10],
                [11, 12, 13, 14, 15],
                [16, 17, 18, 19, 20],
                [25, 24, 23, 22, 21],
            ],
            False,
        ),
        # 8 — 1x1
        ([[1]], True),
        # 9 — ошибка в последнем элементе
        (
            [
                [1, 2, 3, 4, 5],
                [6, 7, 8, 9, 10],
                [11, 12, 13, 14, 15],
                [16, 17, 18, 19, 20],
                [21, 22, 23, 24, 26],
            ],
            False,
        ),
        # 10 — не квадратная
        (
            [
                [1, 2, 3],
                [4, 5, 6],
            ],
            "Матрица не подходит",
        ),
    ],
)
def test_13_1_8(matrix, expected):
    assert m_13_1_8(matrix) == expected
